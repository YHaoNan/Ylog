<html><head><title>Vuex状态管理</title></head><body><p>Vue中可以通过子组件可以通过<code>prop</code>获取父组件传入的数据，子组件可以通过<code>$emit</code>来发射事件与父组件交互，但是很多情况下不单单是父子组件之间的交互，还需要跨级交互和兄弟组件交互。Vuex可以很好的实现这一功能。</p>

<h2>安装</h2>

<p><code>npm i -P vuex</code></p>

<h2>引用</h2>

<p>它也是一个插件，和路由插件一样，需要先<code>Vue.use</code>，然后再在根节点的配置中指定一下。</p>

<p>目录结构如下，完全复制自路由那篇笔记。</p>

<pre><code>.
├── index.html
├── package.json
├── package-lock.json
├── src
│   ├── about.vue
│   ├── App.vue
│   ├── index.js
│   ├── index.vue
│   └── user.vue
└── webpack.config.js

1 directory, 9 files
</code></pre>

<p>在<code>index.js</code>中引用Vuex：</p>

<pre><code class="language-js">import Vue from &#39;vue&#39;
import App from &#39;./App.vue&#39;
import VueRouter from &#39;vue-router&#39;
import Vuex from &#39;vuex&#39;

Vue.use(Vuex);
Vue.use(VueRouter);

//...

const store = new Vuex.Store({
    
})

new Vue({
    el: &#39;#app&#39;,
    router: router,
    store: store,
    render: h =&gt; h(App)
});

</code></pre>

<p>我们通过这个<code>store</code>来存储全局状态，比如：</p>

<pre><code class="language-js">const store = new Vuex.Store({
    state: {
        count: 0
    }              
})
</code></pre>

<p><code>state</code>是全局可访问的状态，这里面的变量都是响应式的，可以在其他组件这样引用它：</p>

<p><code>index.vue</code>：</p>

<pre><code class="language-html">&lt;template&gt;
    &lt;div&gt;
        {{ $store.state.count }}
        This is the index page.
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>

<p>如果在所有需要引用<code>count</code>的地方都这样写有些麻烦，可以用<code>computed</code>：</p>

<pre><code class="language-html">&lt;template&gt;
    &lt;div&gt;
        {{ count }}
        This is the index page.
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    computed: {
        count () {
            return this.$store.state.count;
        }
    }
}
&lt;/script&gt;
</code></pre>

<p>如果想写入计数器中的数据，不能直接写，而是要提交<code>mutations</code>。</p>

<pre><code class="language-js">const store = new Vuex.Store({
    state: {
        count: 0
    },
    mutations: {
        increment (state) {
            state.count++
        },
        decrement (state) {
            state.count--
        }
    }
})
</code></pre>

<p>我们给store添加了两个<code>mutations</code>，在组件中我们可以通过<code>commit</code>调用它：</p>

<pre><code class="language-html">&lt;template&gt;
    &lt;div&gt;
        {{ count }}
        This is the index page.
        &lt;button @click=&#34;handleIncrement&#34;&gt;+&lt;/button&gt;
        &lt;button @click=&#34;handleDecrement&#34;&gt;-&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    computed: {
        count () {
            return this.$store.state.count;
        }
    },
    methods: {
        handleIncrement () {
            this.$store.commit(&#39;increment&#39;);
        },
        handleDecrement () {
            this.$store.commit(&#39;decrement&#39;);
        }
    }
}
&lt;/script&gt;
</code></pre>

<p><code>commit</code>也可以传参</p>

<pre><code class="language-js">mutations: {
    changeCount (state , n=1) {
        state.count += n
    },
}
</code></pre>

<pre><code class="language-html">&lt;template&gt;
    &lt;div&gt;
        {{ count }}
        This is the index page.
        &lt;button @click=&#34;handleIncrement&#34;&gt;+&lt;/button&gt;
        &lt;button @click=&#34;handleDecrement&#34;&gt;-&lt;/button&gt;
        &lt;br&gt;
        Step: &lt;input type=&#34;number&#34; v-model.number=&#34;step&#34;&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    data () {
        return {
            step: 1
        }
    },
    computed: {
        count () {
            return this.$store.state.count;
        }
    },
    methods: {
        handleIncrement () {
            this.$store.commit(&#39;changeCount&#39;,this.step);
        },
        handleDecrement () {
            this.$store.commit(&#39;changeCount&#39;,-this.step);
        }
    }
}
&lt;/script&gt;
</code></pre>

<h2>getters</h2>

<p>Vuex还可以提供一个<code>getters</code>，它类似于组件的<code>computed</code>，假如我们的状态中有一个列表，业务中经常要用到取列表中的正数，但是在每一个组件中编写这个逻辑代码就太冗余了，所以可以在<code>vuex</code>的getters中写:</p>

<pre><code class="language-js">getters: {
    filteredList (state) {
        return state.list.filter(item=&gt;item&gt;0);
    }
}
</code></pre>

<p>在组件中可以这样用：
<code>this.$store.getters.filteredList</code></p>

<h2>actions</h2>

<p>actions是用来做异步操作的。</p>

<pre><code class="language-js">actions: {
    asyncFunction (context) {
        return new Promise(resolve =&gt; {
            setTimeout(()=&gt;{
                resolve(&#39;ok&#39;);
            },1000)
        })
    }
}
</code></pre>

<pre><code class="language-js">callIt () {
    this.$store.dispatch(&#39;asyncFunction&#39;).then(res=&gt;{
        console.log(res);
    })
}
</code></pre>

<h2>modules</h2>

<p>如果状态过多，可以分模块。</p>

<pre><code class="language-js">const moduleA = {
    state: {}
}
//..
const store = new Vuex.Store({
    modules: {
        a: moduleA
    }
})
</code></pre>

<p>子节点的getters和mutation可以接受第三个参数rootState来访问root的状态。</p>
</body></html>