---
title: VIM常用技巧
date: 2019-08-21 9:22:27
tags: [vim]
categories: Vim
---

# `.`命令
`.`命令可以重复上次的修改。

比如我们想给每一行加上一个分号：
```js
var foo = 1
var bar = 'a'
var foobar = foo + bar
```

我们可以使用`.`来操作，比如我们现在在最后一行，按`A`在行尾追加，之后按`;`添加分号。

这样我们完成了一行的操作，然后我们可以退出输入模式，并按`k`上移一行，然后按`.`，这一行的行尾也被添加了分号，重复这个输入直到为所有行添加完毕。

再看一个示例，我们想在连接字符串的两个加号前后添加空格，让代码可读性更高：
```js
var foo = "method("+argument1+","+argument2+")";
```
对于这个问题，我们可以使用`f+`定位到第一个加号，然后使用`s`删除当前字符并切换到输入模式，之后输入空格 + 空格。

这样做的好处是这可以让VIM认为是一次操作，使用`.`可以重复这次操作，我们用`;`切换到下一个`+`的位置，然后再按`.`，VIM会重复我们的操作。一直重复这个操作到所有加号都被添加了空格。

虽然这个操作可以用VIM的批量替换完成，但是批量替换你需要花时间数有多少个加号，并且你还要考虑某一个加号是否需要添加前后空格，如果不需要你还要回去修改它。所以有时多按几下按键也是不错的选择。

# 数字操作
使用`<C-a>`和`<C-x>`可以针对行内的数字进行加减操作。

比如使用`10<C-a>`，会将当前光标下的数字加十，如果当前光标下不是数字，则正向查找一个数字。

```css
.blog { background-position: -180px -180px }
```
假设要把上面的cs代码中的两个`0px`改成`-180px`，我们就可以用这个。

`180<C-x>w.`，这个输入可以完成操作，先用`180<C-x>`来把第一个数字修改为目标值，然后按`w`，将光标移动到下一个单词处，按`.`重复操作。

# 修改`esc`按键
`esc`是非常常用的一个按键，但是在键盘上它并不容易按到，可以用`<C-[>`切换回普通模式，但这毕竟需要两个按键。

相对而言，大写锁定键一般都很好按，就在手边，而且异常的大，但是我觉得我一辈子都按不了几次它。所以把这个按键改成`esc`还是挺合适的。

修改的方法请看这个文章吧：[VIM将CapsLock大写锁定键映射成Esc键](https://www.xuecaijie.com/vim/198.html)

# 插入模式快捷键
VIM的多模式设计非常好用，而且在输入完一部分东西后就返回普通模式确实是个好习惯。不过如果在输入过程中有一点错误的话就需要退出回普通模式修正这有点得不偿失。好在可以有一些快捷键来帮助我们在输入模式中快速修改。

按键|用途
:-:|:-:
<C-h>|删除前一个字符
<C-w>|删除前一个单词
<C-u>|删除到行首
<C-o>|切换到插入普通模式
<C-r>{register}|从寄存器粘贴
<C-r>={expr}|插入表达式所代表的值
<C-v>{code}|插入字符编码所代表的字符
<C-k>{char1}{char2}|插入二合字母

## 解释
插入普通模式即返回普通模式然后输入一个命令后自动切换到插入模式。

寄存器是VIM中保存文本的地方。

如果输入`<C-r>=6*35`则会输入`6*35`的运算结果

字符编码可以直接用三位数字，也可以用unicode编码，也可以用按键。

二合字母是VIM的快捷输入功能，如`<C-k>?I`会输入¿。可以使用`:h digraph-table`查看所有二合字母表。

## zz
zz可以把当前行显示到屏幕中间，方便阅读。

## 可视模式

命令|用途
:-:|:-:
v|激活面向字符的可视模式
V|激活面向行的可视模式
<C-v>|激活面向列块的可视模式
gv|重选上次的高亮选区
o|切换选区活动端

只有当动作命令难以完成操作时考虑可视模式。


## 命令模式
Vim的命令模式在普通模式下由`:`启动，命令的格式一般如下：  
`:[范围]操作 {参数}`

常用命令如下：

命令|用途
:-:|:-:
:[range]delete [x]|删除指定范围的行到寄存器x中
:[range]yank [x]|复制指定范围的行到寄存器x中
:[line]put [x]|在指定行后面添加寄存器x中的内容
:[range]copy {address}|把指定范围内的行拷贝到{address}之下
:[range]move {address}|把指定范围内的行拷贝到{address}之下
:[range]join|链接制定范围内的行
:[range]normal {command}|对指定范围内的每一行执行一个普通模式命令
:[range]substitute/{pattern}/{string}/{flags}|把指定范围内出现{pattern}的地方替换成{string}
:[range]global/{pattern}/{cmd}|对指定范围内匹配{pattern}的所有行，在其上执行ex命令

### range
range用来指定大多数命令的作用范围，它的格式如下：

- `1,5p` -- 打印第一行到第五行的内容
- `.,$p` -- 打印当前行到最后一行的内容
- `3p` -- 打印第三行的内容
- `p` -- 打印当前行的内容
- `%p` -- 打印所有行内容，相当于`1,$p`
- `/<html>/`,`/<\/html>p` -- 打印`<html></html>`标签中间的内容


### 偏移
range可以指定一个偏移，格式如下`{address}+n,{address+n}command`，如：

- `/<html>/+1,<\/html>-1p` -- 打印html标签中的内容但不包含html标签
- `-1p`代表打印上一行的内容

## `:t`和`:m`
`:t`和`:m`分别是`:copy`和`:move`的缩写。

- `:.t.` -- 拷贝当前行到下一行，和`yyp`差不多，但是这个不占用寄存器
- `:t.` -- 同上
- `:t$` -- 把当前行复制到文本结尾
- `:10,20t$` -- 把10到20行复制到文件尾

`m`和它用法一样就不解释了。

### 虚拟行0
这两个命令都是把某些文本拷贝到某一行的下面，那么如果我们想拷贝到第一行可咋办呢？VIM提供了一个虚拟行0

`:t0` -- 把当前行拷贝到第一行

### 基于选区
如果当前有可视模式选中的文本，那么`'<`代表选中的开头位置，`'>`代表结尾。比如：

```
Shopping list
    Hardware Store
        Buy nails
        Buy new hammer
    Beauty Parlor
        Buy nail polish remover
        Buy nails
```

我们想把`Hardware Store`移动到`Beauty Parlor`下面，我们可以这么做：

1. 光标移动到`Hardware Store`那一行
2. `Vjj`
3. `'<,'>m$`

按`@:`可以重复上次的命令

## 在指定范围上执行普通模式命令
我们需要给100行js代码结尾添加分号，虽然可以用`.`进行重复普通命令，但是还是需要按200多次按键，不过在VIM中我们可以在指定范围上执行普通模式命令。

```
var foo = 1
var bar = 2
bar baz = 3
var foobarbaz = foo + bar + baz
//...96 lines ignored
```

我们可以这样做：
1. `gg` -- 移动到文件首
2. `A;` -- 在行尾添加`;`
3. `:$normal .`

还可以更简单：
- `:%normal A;`

这个命令执行时会自动把每一行的光标放在行首。


